<section class="scrollable">
  <article class="standard-form">

    {{log this}}

    {{formGroup fields.name name="name" value=effect.name localize=true}}

    {{formGroup fields.type name="type" value=effect.type localize=true}}

    {{formGroup
      fields.flags.fields.isMagical
      name="flags.isMagical"
      value=effect.flags.isMagical
      localize=true
    }}

    {{formGroup
      fields.flags.fields.isLikeAttack
      name="flags.isLikeAttack"
      value=effect.flags.isLikeAttack
      localize=true
    }}

    {{#if (eq effect.type "macro")}}
      <fieldset>
        <legend>Macro settings</legend>

        {{formGroup fields.macro value=effect.macro name="macro" localize=true}}
      </fieldset>
    {{/if}}

    {{#if (eq effect.type "script")}}
      <fieldset>
        <legend>Script settings</legend>

        {{formInput
          fields.script
          value=effect.script
          name="script"
          localize=true
        }}
      </fieldset>
    {{/if}}

    {{formGroup
      fields.flags.fields.canBeResisted
      value=effect.flags.canBeResisted
      name="flags.canBeResisted"
      localize=true
    }}

    {{#if effect.flags.canBeResisted}}
      <fieldset>
        <legend>{{localize "BAGS.Actions.Effects.Resistance.Heading"}}</legend>

        {{formGroup
          fields.resistance.fields.type
          value=effect.resistance.type
          name="resistance.type"
          localize=true
        }}

        {{#if (eq effect.resistance.type "savingThrow")}}
          {{formGroup
            fields.resistance.fields.savingThrow
            value=effect.resistance.savingThrow
            name="resistance.savingThrow"
            localize=true
          }}
        {{else}}
          <fieldset class="roll-fields">
            <legend>Roll</legend>

            {{formGroup
              fields.resistance.fields.roll.fields.formula
              value=effect.resistance.roll.formula
              name="resistance.formula"
              localize=true
            }}
            {{formGroup
              fields.resistance.fields.roll.fields.operator
              value=effect.resistance.roll.operator
              name="resistance.operator"
              localize=true
            }}

            {{#if (eq resistance.type "abilityScore")}}
              {{formGroup
                fields.resistance.fields.abilityScore
                value=effect.resistance.abilityScore
                name="resistance.abilityScore"
                localize=true
              }}
            {{/if}}
            {{log effect.resistance.type}}
            {{#if (eq effect.resistance.type "number")}}
              {{formGroup
                fields.resistance.fields.roll.fields.target
                value=effect.resistance.roll.target
                name="resistance.staticTarget"
                localize=true
              }}
            {{/if}}
          </fieldset>
        {{/if}}
      </fieldset>
    {{/if}}

    {{#if (eq effect.type "attack")}}
      {{formGroup
        fields.formula
        value=effect.formula
        name="formula"
        localize=true
      }}
      {{formGroup fields.note value=effect.note name="note" localize=true}}
    {{/if}}

    {{#if (eq effect.type "healing")}}
      {{formGroup
        fields.formula
        value=effect.formula
        name="formula"
        localize=true
      }}
    {{/if}}

    {{#if (eq effect.type "effect")}}
      <fieldset>
        <legend>{{localize "BAGS.Actions.Effects.Condition.Heading"}}</legend>
        {{formGroup fields.condition.fields.name name="condition.name" value=effect.condition.name localize=true}}
        {{formGroup fields.condition.fields.img name="condition.img" value=effect.condition.img localize=true}}
        {{formGroup fields.condition.fields.description name="condition.description" value=effect.condition.description localize=true}}
        <div class="subheading">
          <h3>{{localize "BAGS.Actions.Effects.Condition.Changes.Heading"}}</h3>
          <button type="button" class="add-change">{{localize "BAGS.Actions.Effects.Condition.Changes.AddButton"}}</button>
        </div>
        {{#if effect.condition.changes.length}}
          {{#for effect.condition.changes}}
            <fieldset class="change-entry">
              {{formGroup ../fields.condition.fields.changes.fields.key name="condition.changes.[{{@index}}].key" value=this.key localize=true}}
              {{formGroup ../fields.condition.fields.changes.fields.value name="condition.changes.[{{@index}}].value" value=this.value localize=true}}
              {{formGroup ../fields.condition.fields.changes.fields.mode name="condition.changes.[{{@index}}].mode" value=this.mode localize=true}}
              {{formGroup ../fields.condition.fields.changes.fields.priority name="condition.changes.[{{@index}}].priority" value=this.priority localize=true}}
            </fieldset>
          {{/for}}
        {{else}}
          <p>{{localize "BAGS.Actions.Effects.Condition.Changes.EmptyState"}}</p>
        {{/if}}
        <fieldset>
          <legend>{{localize "BAGS.Actions.Effects.Condition.Duration.Label"}}</legend>
          {{formGroup fields.condition.fields.duration.fields.rounds name="condition.duration.rounds" value=effect.condition.duration.rounds localize=true}}
          {{formGroup fields.condition.fields.duration.fields.seconds name="condition.duration.seconds" value=effect.condition.duration.seconds localize=true}}
          {{formGroup fields.condition.fields.duration.fields.turns name="condition.duration.turns" value=effect.condition.duration.turns localize=true}}
        </fieldset>
      </fieldset>
    {{/if}}

    {{#if (eq effect.type "misc")}}
      {{formInput
        fields.description
        value=effect.description
        name="description"
        localize=true
      }}
    {{/if}}
  </article>
</section>
